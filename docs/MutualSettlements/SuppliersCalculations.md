# Расчеты с поставщиками (архитектура)

Расчеты с поставщиками в системе сделаны так, что при каждом изменении расчетов запускается перераспределения денежных средств  

Каждый документ, который участвует в расчетах с поставщиками записывается в регистр **Расчеты с поставщиками** (к2РасчетыСПоставщиками)

Если в соглашении расчет по накладным и в документе объект расчета - конкретное поступление товаров и услуг, то данный документ в перераспределении не участвует (нет галочки К распределению)

![1]

Для документов, участвующих в распределении, также идет запись в регистр **Расчеты с поставщиками по срокам** (к2РасчетыСПоставщикамиПоСрокам)  

![2]

Регистратором этого регистра является технический документ **Регистратор расчетов** (к2РегистраторРасчетов)    
Для быстродействия для каждого объекта расчета создается новый Регистратор документов, когда записей в нем становится больше 500. Подсчет записей происходит в регистре **Количество записей регистраторов расчетов** (к2КоличествоЗаписейРегистраторовРасчетов)  

![3]

Для соглашения с расчетом по соглашениям документ Регистратор расчетов один на все время (пока не превышено количество записей). Для соглашений с расчетом по накладным для каждого поступления создается свой документ Регистратор расчетов (для каждого поступления новый регистратор)  

Также, каждый документ, который участвует в расчетах с поставщиками записывается в регистр **Вспомогательная информация взаиморасчетов** (к2ВспомогательнаяИнформацияВзаиморасчетов). Он нужен для правильного распределения денежных средств    
В нем порядок операции - дата платежа (если есть) или дата документа, дата операции - дата планового погашения или дата платежа

![4]

При проведении документа, участвующего в распределении, происходит перераспределение всех документов, которые он затрагивает по объекту расчетов  

Документы, которые уменьшают задолженность, берут документы, которые меньше его по дате платежа, и оплачивают их по дате операции (начиная с самой ранней)  
В регистр **Расчеты с поставщиками** при проведении документа Прихода сразу идет правильная запись, т.е. в объект расчета записывается оплачиваемый объект. Таким образом регистр закрывается

[1]: SuppliersCalculations.assets/1.png
[2]: SuppliersCalculations.assets/2.png
[3]: SuppliersCalculations.assets/3.png
[4]: SuppliersCalculations.assets/4.png